pipeline {
agent any
environment {
    registry = "ritul3007/devops_practice"
    registryCredential = 'docker-hub'
    dockerImage = ''
  }
   
stages {
       
    stage('Build Image') {
        steps{
            script {
			sh "docker build -t $registry:${env.BUILD_ID} ./vaadin-crm"
			sh "docker tag $registry:${env.BUILD_ID} $registry:latest"
			sh 'docker-compose up -d'
            }
        }
    }
	
	
   stage('PUSH image to Docker Hub') {
	    steps {
	        script{
		        docker.withRegistry('', registryCredential) {
				 sh "docker push $registry/vaadin-crm:${env.BUILD_ID}"
				 sh "docker push $registry/vaadin-crm:latest"
		        }
	        }
		
		echo "Trying to Push Docker Image"
        }
    }
	
	stage('Remove Unused docker image') {
        steps{
            script{
            sh "docker rmi $registry$BUILD_NUMBER"
            }
        }
    }
  } 	 	
}
