pipeline {
agent any
environment {
    registry = "ritul3007/devops_practice"
    registryCredential = 'docker-hub'
    dockerImage = ''
  }
   
stages {
       
    stage('Build Image') {
        steps{
            script {
                dockerImage = docker.build(registry + ":$BUILD_NUMBER" , "./vaadin-crm")
                dockerImage.tag(registry + ":$BUILD_NUMBER" , registry + ":latest")
            }
        }
    }
	
	
   stage('PUSH image to Docker Hub') {
	    steps {
	        script{
		        docker.withRegistry(registry+'/vaadin-crm', registryCredential) {
		        dockerImage.push("${env.BUILD_NUMBER}")
                dockerImage.push("latest")
		        }
	        }
		
		echo "Trying to Push Docker Image"
        }
    }
	
	stage('Remove Unused docker image') {
        steps{
            script{
            docker.rmi(registry+":$BUILD_NUMBER")
            }
        }
    }
  } 	 	
}
